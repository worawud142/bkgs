<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'IBM Plex Sans Thai', 'IBM Plex Sans', sans-serif;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://media-library.cloudinary.com/global/all.js"></script>
    <script src="js/config.js"></script>
</head>

<body class="bg-gray-100 min-h-screen">

    <!-- Login Section -->
    <div id="loginSection" class="flex items-center justify-center min-h-screen">
        <div class="bg-white p-8 rounded-lg shadow-lg w-96">
            <h2 class="text-2xl font-bold mb-6 text-center text-blue-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="email"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="password"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
            <p id="loginError" class="mt-4 text-red-500 text-sm text-center hidden"></p>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboardSection" class="hidden">
        <nav class="bg-blue-600 text-white p-4 shadow-md">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-xl font-bold">Admin Dashboard</h1>
                <button id="logoutBtn" class="bg-blue-700 px-4 py-2 rounded hover:bg-blue-800">Logout</button>
            </div>
        </nav>

        <!-- Tabs Navigation -->
        <div class="container mx-auto px-6 pt-6">
            <div class="flex gap-2 border-b flex-wrap">
                <button id="tabNews" onclick="switchTab('news')"
                    class="px-4 py-2 font-medium border-b-2 border-blue-600 text-blue-600">
                    üì∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß
                </button>
                <button id="tabBanners" onclick="switchTab('banners')"
                    class="px-4 py-2 font-medium text-gray-500 hover:text-gray-700">
                    üñºÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå
                </button>
                <button id="tabEvents" onclick="switchTab('events')"
                    class="px-4 py-2 font-medium text-gray-500 hover:text-gray-700">
                    üìÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                </button>
                <button id="tabDonation" onclick="switchTab('donation')"
                    class="px-4 py-2 font-medium text-gray-500 hover:text-gray-700">
                    üí∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ
                </button>
                <button id="tabStaff" onclick="switchTab('staff')"
                    class="px-4 py-2 font-medium text-gray-500 hover:text-gray-700">
                    üë®‚Äçüè´ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£
                </button>
                <button id="tabDocuments" onclick="switchTab('documents')"
                    class="px-4 py-2 font-medium text-gray-500 hover:text-gray-700">
                    üìÑ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                </button>
            </div>
        </div>

        <!-- News Section -->
        <div id="newsSection" class="container mx-auto p-6">
            <div class="flex justify-between mb-6">
                <h2 class="text-2xl font-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <button onclick="openModal()"
                    class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center gap-2">
                    <span>+</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ‡∏£‡∏π‡∏õ‡∏õ‡∏Å</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="newsTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Banners Section -->
        <div id="bannersSection" class="container mx-auto p-6 hidden">
            <div class="flex justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-semibold">üñºÔ∏è ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</h2>
                    <p class="text-sm text-gray-500 mt-1">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πÑ‡∏•‡∏î‡πå‡πÇ‡∏ä‡∏ß‡πå‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</p>
                </div>
                <button onclick="openBannerModal()"
                    class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center gap-2">
                    <span>+</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå
                </button>
            </div>

            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏ä‡∏∑‡πà‡∏≠</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏•‡∏¥‡∏á‡∏Å‡πå</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="bannersTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Banner Modal Form -->
        <div id="bannerModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
            <div class="relative top-20 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="bannerModalTitle" class="text-lg font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</h3>
                    <button onclick="closeBannerModal()"
                        class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>

                <form id="bannerForm" class="space-y-4">
                    <input type="hidden" id="editBannerId" name="id">

                    <div>
                        <label class="block text-sm font-medium">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</label>
                        <input type="text" id="bannerTitle" name="title" class="mt-1 block w-full border rounded p-2"
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà 2569">
                    </div>

                    <div>
                        <label class="block text-sm font-medium">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                        <input type="hidden" id="bannerImageUrl" name="image_url">
                        <div class="mt-2 space-y-3">
                            <div class="relative w-full aspect-[16/9] bg-gray-100 rounded border overflow-hidden">
                                <img id="bannerImagePreview" src="https://via.placeholder.com/800x450?text=Preview"
                                    class="w-full h-full object-cover">
                            </div>
                            <input type="file" id="bannerImageFile" accept="image/*"
                                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                            <p class="text-xs text-gray-500">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏ô‡∏≤‡∏î 1600x900 px (‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô 16:9)
                                ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium">‡∏•‡∏¥‡∏á‡∏Å‡πå (URL)</label>
                        <input type="text" id="bannerLinkUrl" name="link_url"
                            class="mt-1 block w-full border rounded p-2" placeholder="https://... ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ">
                        <p class="text-xs text-gray-500 mt-1">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á</label>
                            <input type="number" id="bannerSortOrder" name="sort_order"
                                class="mt-1 block w-full border rounded p-2" value="1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                            <select id="bannerIsActive" name="is_active" class="mt-1 block w-full border rounded p-2">
                                <option value="true">üü¢ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                                <option value="false">üî¥ ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                        <select id="bannerImagePosition" name="image_position"
                            class="mt-1 block w-full border rounded p-2"
                            onchange="document.getElementById('bannerImagePreview').style.objectPosition = this.value">
                            <option value="center">‡∏Å‡∏•‡∏≤‡∏á (Center)</option>
                            <option value="top">‡∏ö‡∏ô (Top)</option>
                            <option value="bottom">‡∏•‡πà‡∏≤‡∏á (Bottom)</option>
                            <option value="left">‡∏ã‡πâ‡∏≤‡∏¢ (Left)</option>
                            <option value="right">‡∏Ç‡∏ß‡∏≤ (Right)</option>
                            <option value="top left">‡∏ö‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ (Top Left)</option>
                            <option value="top right">‡∏ö‡∏ô‡∏Ç‡∏ß‡∏≤ (Top Right)</option>
                            <option value="bottom left">‡∏•‡πà‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ (Bottom Left)</option>
                            <option value="bottom right">‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤ (Bottom Right)</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏£‡∏≠‡∏õ</p>
                    </div>

                    <div class="flex justify-end gap-2 pt-4">
                        <button type="button" onclick="closeBannerModal()"
                            class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit"
                            class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Events Section -->
        <div id="eventsSection" class="container mx-auto p-6 hidden">
            <div class="flex justify-between mb-6">
                <h2 class="text-2xl font-semibold">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
                <button onclick="openEventModal()"
                    class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center gap-2">
                    <span>+</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="eventsTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Donation Section -->
        <div id="donationSection" class="container mx-auto p-6 hidden">
            <div class="grid lg:grid-cols-2 gap-6">
                <!-- Settings Form -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</h2>
                    <form id="donationSettingsForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium">URL ‡∏£‡∏π‡∏õ QR Code</label>
                            <input type="url" id="qrCodeUrl" class="mt-1 block w-full border rounded p-2"
                                placeholder="https://... ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏™‡πà URL">
                            <p class="text-xs text-gray-500 mt-1">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ QR ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Supabase Storage ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏™‡πà URL</p>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
                                <input type="text" id="accountName" class="mt-1 block w-full border rounded p-2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</label>
                                <input type="text" id="bankName" class="mt-1 block w-full border rounded p-2">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
                            <input type="text" id="accountNumber" class="mt-1 block w-full border rounded p-2">
                        </div>

                        <div>
                            <label class="block text-sm font-medium">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
                            <input type="text" id="projectName" class="mt-1 block w-full border rounded p-2"
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏î‡∏°‡∏≠‡πÄ‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium">‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="totalAmount" class="mt-1 block w-full border rounded p-2"
                                    value="0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="goalAmount" class="mt-1 block w-full border rounded p-2"
                                    value="500000">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                            <input type="number" id="donorCount" class="mt-1 block w-full border rounded p-2" value="0">
                        </div>

                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                        </button>
                    </form>
                </div>

                <!-- Donors List -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">üôè ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</h2>
                        <button onclick="openDonorModal()"
                            class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ
                        </button>
                    </div>
                    <div id="donorsTableContainer" class="max-h-96 overflow-y-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">‡∏ä‡∏∑‡πà‡∏≠</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="px-4 py-2 text-xs font-medium text-gray-500">‡∏•‡∏ö</th>
                                </tr>
                            </thead>
                            <tbody id="donorsTableBody" class="divide-y divide-gray-200">
                                <!-- Rows populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Donor Modal -->
    <div id="donorModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</h3>
                <button onclick="closeDonorModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>

            <form id="donorForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                    <input type="text" id="donorName" class="mt-1 block w-full border rounded p-2"
                        placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏´‡∏£‡∏∑‡∏≠ ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠">
                </div>
                <div>
                    <label class="block text-sm font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="donorAmount" class="mt-1 block w-full border rounded p-2" required>
                </div>
                <div>
                    <label class="block text-sm font-medium">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <input type="text" id="donorMessage" class="mt-1 block w-full border rounded p-2"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏∏‡πà‡∏ô 5, ‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤">
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="closeDonorModal()"
                        class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit"
                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Staff Section -->
    <div id="staffSection" class="container mx-auto p-6 hidden">
        <div class="flex justify-between mb-6">
            <h2 class="text-2xl font-semibold">üë®‚Äçüè´ ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ & ‡∏Ñ‡∏ì‡∏∞‡∏Ñ‡∏£‡∏π</h2>
            <button onclick="openStaffModal()"
                class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center gap-2">
                <span>+</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£
            </button>
        </div>

        <div class="bg-white rounded-lg shadow overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="staffTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Rows will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Documents Section -->
    <div id="documentsSection" class="container mx-auto p-6 hidden">
        <div class="flex justify-between mb-6">
            <div>
                <h2 class="text-2xl font-semibold">üìÑ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</h2>
                <p class="text-sm text-gray-500 mt-1">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</p>
            </div>
            <button onclick="openDocumentModal()"
                class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center gap-2">
                <span>+</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            </button>
        </div>

        <div class="bg-white rounded-lg shadow overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏•‡∏¥‡∏á‡∏Å‡πå/‡πÑ‡∏ü‡∏•‡πå</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="documentsTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Rows will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Document Modal Form -->
    <div id="documentModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 id="documentModalTitle" class="text-lg font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>
                <button onclick="closeDocumentModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>

            <form id="documentForm" class="space-y-4">
                <input type="hidden" id="editDocumentId" name="id">

                <div>
                    <label class="block text-sm font-medium">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label>
                    <input type="text" id="documentTitle" name="title" class="mt-1 block w-full border rounded p-2"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" required>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                    <div class="mt-2 flex gap-4">
                        <label class="inline-flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="doc_type" value="link" checked onchange="toggleDocType()"
                                class="text-blue-600">
                            <span class="text-sm">üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå URL</span>
                        </label>
                        <label class="inline-flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="doc_type" value="file" onchange="toggleDocType()"
                                class="text-blue-600">
                            <span class="text-sm">üìé ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</span>
                        </label>
                    </div>
                </div>

                <div id="docLinkField">
                    <label class="block text-sm font-medium">URL ‡∏•‡∏¥‡∏á‡∏Å‡πå</label>
                    <input type="url" id="documentUrl" name="file_url" class="mt-1 block w-full border rounded p-2"
                        placeholder="https://drive.google.com/... ‡∏´‡∏£‡∏∑‡∏≠ URL ‡∏≠‡∏∑‡πà‡∏ô‡πÜ">
                    <p class="text-xs text-gray-500 mt-1">‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Google Drive, Dropbox ‡∏´‡∏£‡∏∑‡∏≠ URL ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÉ‡∏î‡πÜ</p>
                </div>

                <div id="docFileField" class="hidden">
                    <label class="block text-sm font-medium">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</label>
                    <input type="file" id="documentFile" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.zip,.rar"
                        class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="text-xs text-gray-500 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå PDF, Word, Excel, PowerPoint, ZIP (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 50MB)</p>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á</label>
                    <input type="number" id="documentSortOrder" name="sort_order"
                        class="mt-1 block w-full border rounded p-2" value="1">
                </div>

                <div class="flex justify-end gap-2 pt-4">
                    <button type="button" onclick="closeDocumentModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit"
                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Staff Modal Form -->
    <div id="staffModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 id="staffModalTitle" class="text-lg font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h3>
                <button onclick="closeStaffModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>

            <form id="staffForm" class="space-y-4">
                <input type="hidden" id="editStaffId" name="id">

                <div>
                    <label class="block text-sm font-medium">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="staffName" name="name" class="mt-1 block w-full border rounded p-2"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏≠‡∏†‡∏¥‡∏ä‡∏≤‡∏ï‡∏¥ ‡πÉ‡∏à‡∏î‡∏µ" required>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <input type="text" id="staffPosition" name="position" class="mt-1 block w-full border rounded p-2"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô ‡∏õ.1">
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                    <select id="staffCategory" name="category" class="mt-1 block w-full border rounded p-2">
                        <option value="executive">üëî ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</option>
                        <option value="kindergarten">üéí ‡∏Ñ‡∏£‡∏π‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•</option>
                        <option value="p1">üìö ‡∏Ñ‡∏£‡∏π ‡∏õ.1</option>
                        <option value="p2">üìö ‡∏Ñ‡∏£‡∏π ‡∏õ.2</option>
                        <option value="p3">üìö ‡∏Ñ‡∏£‡∏π ‡∏õ.3</option>
                        <option value="p4">üìñ ‡∏Ñ‡∏£‡∏π ‡∏õ.4</option>
                        <option value="p5">üìñ ‡∏Ñ‡∏£‡∏π ‡∏õ.5</option>
                        <option value="p6">üìñ ‡∏Ñ‡∏£‡∏π ‡∏õ.6</option>
                        <option value="m1">üìò ‡∏Ñ‡∏£‡∏π ‡∏°.1</option>
                        <option value="m2">üìò ‡∏Ñ‡∏£‡∏π ‡∏°.2</option>
                        <option value="m3">üìò ‡∏Ñ‡∏£‡∏π ‡∏°.3</option>
                        <option value="other">üë©‚Äçüè´ ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                    <input type="hidden" id="staffPhotoUrl" name="photo_url">
                    <div class="mt-2 flex items-center gap-4">
                        <img id="staffPhotoPreview" src="https://via.placeholder.com/80?text=No+Photo"
                            class="w-20 h-20 rounded-full object-cover bg-gray-200 border">
                        <div class="flex-1 space-y-2">
                            <input type="file" id="staffPhotoFile" accept="image/*"
                                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                            <div class="text-xs text-gray-400 text-center">‡∏´‡∏£‡∏∑‡∏≠</div>
                            <button type="button" onclick="openCloudinaryBrowser('staff')"
                                class="w-full py-2 px-4 bg-purple-50 text-purple-700 rounded border border-purple-200 hover:bg-purple-100 text-sm font-medium flex items-center justify-center gap-2">
                                ‚òÅÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Cloudinary
                            </button>
                            <input type="hidden" id="staffPhotoUrlInput">
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á</label>
                    <input type="number" id="staffSortOrder" name="sort_order"
                        class="mt-1 block w-full border rounded p-2" placeholder="1, 2, 3... (‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô)"
                        value="10">
                </div>

                <div class="flex justify-end gap-2 pt-4">
                    <button type="button" onclick="closeStaffModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit"
                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Modal Form -->
    <div id="eventModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 id="eventModalTitle" class="text-lg font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
                <button onclick="closeEventModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>

            <form id="eventForm" class="space-y-4">
                <input type="hidden" id="editEventId" name="id">

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)</label>
                        <input type="text" id="eventDay" name="day" class="mt-1 block w-full border rounded p-2"
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô 15" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ</label>
                        <input type="text" id="eventMonth" name="month" class="mt-1 block w-full border rounded p-2"
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.‡∏Ñ. 69" required>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                    <input type="text" id="eventTitle" name="title" class="mt-1 block w-full border rounded p-2"
                        required>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà / ‡πÄ‡∏ß‡∏•‡∏≤</label>
                    <input type="text" id="eventPlace" name="place" class="mt-1 block w-full border rounded p-2"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‚Ä¢ 09:00-12:00 ‡∏ô.">
                </div>

                <div class="flex justify-end gap-2 pt-4">
                    <button type="button" onclick="closeEventModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit"
                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Form -->
    <div id="newsModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-lg font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">&times;</button>
            </div>

            <form id="newsForm" class="space-y-4" enctype="multipart/form-data">
                <input type="hidden" id="editId" name="id">

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô 20 ‡∏™.‡∏Ñ. 2568)</label>
                        <input type="text" id="newsDate" name="date" class="mt-1 block w-full border rounded p-2"
                            required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Tag)</label>
                        <select id="newsTag" name="tag" class="mt-1 block w-full border rounded p-2">
                            <option value="‡∏Ç‡πà‡∏≤‡∏ß">‡∏Ç‡πà‡∏≤‡∏ß</option>
                            <option value="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
                            <option value="‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£">‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</option>
                            <option value="‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå">‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label>
                    <input type="text" id="newsTitle" name="title" class="mt-1 block w-full border rounded p-2"
                        required>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏£‡∏π‡∏õ‡∏õ‡∏Å</label>
                    <div class="mt-1 space-y-2">
                        <!-- Preview -->
                        <div id="coverPreviewContainer"
                            class="hidden relative w-full h-48 bg-gray-100 rounded-lg overflow-hidden border border-dashed border-gray-300 flex items-center justify-center">
                            <img id="coverPreview" class="w-full h-full object-cover">
                            <button type="button" onclick="removeCover()"
                                class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20"
                                    fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                        clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>

                        <!-- File Input -->
                        <input type="file" id="newsCoverFile" name="cover" accept="image/*" class="block w-full text-sm text-slate-500
                              file:mr-4 file:py-2 file:px-4
                              file:rounded-full file:border-0
                              file:text-sm file:font-semibold
                              file:bg-blue-50 file:text-blue-700
                              hover:file:bg-blue-100
                            " />

                        <!-- Hidden Existing URL storage -->
                        <input type="hidden" id="newsCoverUrl" name="existingCover">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏õ‡∏Å</label>
                    <div class="mt-1 flex items-center gap-3">
                        <select id="newsCoverPosition" name="cover_position" class="flex-1 border rounded p-2">
                            <option value="center">‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á (Center)</option>
                            <option value="top">‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô (Top)</option>
                            <option value="bottom">‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (Bottom)</option>
                            <option value="left">‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ (Left)</option>
                            <option value="right">‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ (Right)</option>
                        </select>
                        <div class="flex gap-1">
                            <button type="button" onclick="setCoverPosition('top')" title="‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô"
                                class="px-2 py-1 border rounded hover:bg-gray-100 text-sm">‚¨ÜÔ∏è</button>
                            <button type="button" onclick="setCoverPosition('center')" title="‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á"
                                class="px-2 py-1 border rounded hover:bg-gray-100 text-sm">‚è∫Ô∏è</button>
                            <button type="button" onclick="setCoverPosition('bottom')" title="‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á"
                                class="px-2 py-1 border rounded hover:bg-gray-100 text-sm">‚¨áÔ∏è</button>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">üí° ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏£‡∏≠‡∏õ (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏π‡∏õ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ô ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                        "‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤)</p>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏¢‡πà‡∏≠</label>
                    <textarea id="newsDesc" name="desc" rows="2" class="mt-1 block w-full border rounded p-2"
                        required></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium">üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå Facebook ‡πÇ‡∏û‡∏™‡∏ï‡πå</label>
                    <input type="url" id="newsFacebookUrl" name="facebook_url"
                        class="mt-1 block w-full border rounded p-2" placeholder="https://www.facebook.com/...">
                    <p class="text-xs text-gray-500 mt-1">‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏û‡∏™‡∏ï‡πå Facebook ‡∏Ç‡∏≠‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ
                    </p>
                </div>

                <!-- Gallery Images Upload -->
                <div>
                    <label class="block text-sm font-medium">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ)</label>
                    <div class="mt-1 space-y-3">
                        <!-- Preview Grid -->
                        <div id="galleryPreviewGrid" class="grid grid-cols-4 gap-2">
                            <!-- Previews will be added here -->
                        </div>

                        <!-- Upload Button -->
                        <div class="flex items-center gap-3">
                            <input type="file" id="galleryFiles" accept="image/*" multiple class="block w-full text-sm text-slate-500
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-green-50 file:text-green-700
                                hover:file:bg-green-100" />
                        </div>

                        <!-- Image Settings -->
                        <div id="gallerySettings" class="hidden bg-gray-50 border rounded-lg p-3 space-y-3">
                            <div class="flex flex-wrap gap-4">
                                <div class="flex-1 min-w-[140px]">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">üìê ‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                                    <div class="flex gap-1">
                                        <button type="button" onclick="setGallerySize('small')" data-size="small"
                                            class="gallery-size-btn flex-1 px-2 py-1.5 text-xs border rounded hover:bg-blue-50 transition-colors">
                                            S<br><span class="text-[10px] text-gray-400">25%</span>
                                        </button>
                                        <button type="button" onclick="setGallerySize('medium')" data-size="medium"
                                            class="gallery-size-btn flex-1 px-2 py-1.5 text-xs border rounded bg-blue-100 border-blue-400 text-blue-700 transition-colors">
                                            M<br><span class="text-[10px]">50%</span>
                                        </button>
                                        <button type="button" onclick="setGallerySize('large')" data-size="large"
                                            class="gallery-size-btn flex-1 px-2 py-1.5 text-xs border rounded hover:bg-blue-50 transition-colors">
                                            L<br><span class="text-[10px] text-gray-400">75%</span>
                                        </button>
                                        <button type="button" onclick="setGallerySize('full')" data-size="full"
                                            class="gallery-size-btn flex-1 px-2 py-1.5 text-xs border rounded hover:bg-blue-50 transition-colors">
                                            Full<br><span class="text-[10px] text-gray-400">100%</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex-1 min-w-[140px]">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">üìç ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                                    <div class="flex gap-1">
                                        <button type="button" onclick="setGalleryAlign('left')" data-align="left"
                                            class="gallery-align-btn flex-1 px-2 py-1.5 text-xs border rounded hover:bg-blue-50 transition-colors" title="‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢">
                                            ‚óÄ ‡∏ã‡πâ‡∏≤‡∏¢
                                        </button>
                                        <button type="button" onclick="setGalleryAlign('center')" data-align="center"
                                            class="gallery-align-btn flex-1 px-2 py-1.5 text-xs border rounded bg-blue-100 border-blue-400 text-blue-700 transition-colors" title="‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á">
                                            ‚óè ‡∏Å‡∏•‡∏≤‡∏á
                                        </button>
                                        <button type="button" onclick="setGalleryAlign('right')" data-align="right"
                                            class="gallery-align-btn flex-1 px-2 py-1.5 text-xs border rounded hover:bg-blue-50 transition-colors" title="‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤">
                                            ‡∏Ç‡∏ß‡∏≤ ‚ñ∂
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">üñºÔ∏è ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πà‡∏≠‡πÅ‡∏ñ‡∏ß</label>
                                <div class="flex gap-1">
                                    <button type="button" onclick="setGalleryColumns(1)" data-cols="1"
                                        class="gallery-cols-btn flex-1 px-2 py-1.5 text-xs border rounded bg-blue-100 border-blue-400 text-blue-700 transition-colors">
                                        1 ‡∏£‡∏π‡∏õ
                                    </button>
                                    <button type="button" onclick="setGalleryColumns(2)" data-cols="2"
                                        class="gallery-cols-btn flex-1 px-2 py-1.5 text-xs border rounded hover:bg-blue-50 transition-colors">
                                        2 ‡∏£‡∏π‡∏õ
                                    </button>
                                    <button type="button" onclick="setGalleryColumns(3)" data-cols="3"
                                        class="gallery-cols-btn flex-1 px-2 py-1.5 text-xs border rounded hover:bg-blue-50 transition-colors">
                                        3 ‡∏£‡∏π‡∏õ
                                    </button>
                                    <button type="button" onclick="setGalleryColumns(4)" data-cols="4"
                                        class="gallery-cols-btn flex-1 px-2 py-1.5 text-xs border rounded hover:bg-blue-50 transition-colors">
                                        4 ‡∏£‡∏π‡∏õ
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <p class="text-[11px] text-gray-400">üí° ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πà‡∏≠‡πÅ‡∏ñ‡∏ß ‡∏Ç‡∏ô‡∏≤‡∏î ‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡πÅ‡∏ó‡∏£‡∏Å</p>
                                <button type="button" id="insertGalleryBtn"
                                    class="px-3 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700 whitespace-nowrap disabled:opacity-50"
                                    disabled>
                                    ‡πÅ‡∏ó‡∏£‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
                                </button>
                            </div>
                        </div>

                        <p class="text-xs text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡πÅ‡∏ó‡∏£‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤"
                            (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏£‡∏π‡∏õ)</p>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö HTML ‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)</label>
                    <textarea id="newsContent" name="content" rows="8"
                        class="mt-1 block w-full border rounded p-2 font-mono text-sm" required
                        placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                    <p class="text-xs text-gray-500 mt-1">üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡πÅ‡∏ó‡∏£‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤"
                        ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
                </div>

                <div class="flex justify-end gap-2 pt-4">
                    <button type="button" onclick="closeModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit"
                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Logic -->
    <script>
        // DOM Elements
        const loginSection = document.getElementById('loginSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const loginBtn = loginForm.querySelector('button[type="submit"]');

        // Auth State Listener
        supabase.auth.onAuthStateChange((event, session) => {
            if (session) {
                showDashboard();
            } else {
                showLogin();
            }
        });

        function showDashboard() {
            loginSection.classList.add('hidden');
            dashboardSection.classList.remove('hidden');
            loadNews();
        }

        function showLogin() {
            loginSection.classList.remove('hidden');
            dashboardSection.classList.add('hidden');
        }

        // Login Handler
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loginBtn.textContent = "Checking...";
            loginBtn.disabled = true;
            loginError.classList.add('hidden');

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            console.log('üîê Attempting login for:', email);

            try {
                if (!supabase) {
                    throw new Error('Supabase not initialized. Please check your configuration.');
                }

                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                console.log('Login response:', { data, error });

                if (error) {
                    console.error('‚ùå Login error:', error);
                    throw error;
                }

                if (data?.session) {
                    console.log('‚úÖ Login successful!');
                    // The onAuthStateChange listener will handle showing the dashboard
                } else {
                    throw new Error('No session returned from login');
                }
            } catch (error) {
                console.error('‚ùå Login failed:', error);
                let errorMsg = error.message;

                // Provide helpful error messages
                if (errorMsg.includes('Invalid login credentials')) {
                    errorMsg = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                } else if (errorMsg.includes('Email not confirmed')) {
                    errorMsg = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
                }

                loginError.textContent = "Error: " + errorMsg;
                loginError.classList.remove('hidden');
            } finally {
                loginBtn.textContent = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
                loginBtn.disabled = false;
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?")) return;
            const { error } = await supabase.auth.signOut();
            if (error) alert("Logout error: " + error.message);
        });

        // News Management
        let allNewsMap = new Map();

        async function loadNews() {
            const tableBody = document.getElementById('newsTableBody');
            tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';

            try {
                const { data, error } = await supabase
                    .from('news')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                tableBody.innerHTML = '';
                allNewsMap.clear();

                if (!data || data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</td></tr>';
                    return;
                }

                data.forEach(item => {
                    allNewsMap.set(String(item.id), item);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.event_date || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <img src="${item.cover_image || 'https://via.placeholder.com/100'}" class="h-10 w-16 object-cover rounded bg-gray-200">
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900 max-w-xs truncate">${item.title}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="window.editNews('${item.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="window.deleteNews('${item.id}')" class="text-red-600 hover:text-red-900">‡∏•‡∏ö</button>
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });
            } catch (e) {
                console.error(e);
                tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</td></tr>`;
            }
        }

        // Compress image before upload
        async function compressImage(file, maxWidth = 1200, quality = 0.85) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        // Resize if larger than maxWidth
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }

                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        canvas.toBlob((blob) => {
                            const compressedFile = new File([blob], file.name, {
                                type: 'image/jpeg',
                                lastModified: Date.now()
                            });
                            console.log(`üì∑ ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ: ${(file.size / 1024).toFixed(0)}KB ‚Üí ${(blob.size / 1024).toFixed(0)}KB`);
                            resolve(compressedFile);
                        }, 'image/jpeg', quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        // Upload image to Cloudinary (for news covers)
        async function uploadImage(file) {
            // Compress image before upload (1200px width, 85% quality for news)
            const compressedFile = await compressImage(file, 1200, 0.85);

            // Generate unique public_id to prevent caching issues
            const uniqueId = `news_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;

            const formData = new FormData();
            formData.append('file', compressedFile);
            formData.append('upload_preset', 'school_uploads');
            formData.append('folder', 'news');
            formData.append('public_id', uniqueId); // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

            const response = await fetch(
                'https://api.cloudinary.com/v1_1/dlisgusfp/image/upload',
                { method: 'POST', body: formData }
            );

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || 'Upload failed');
            }

            const data = await response.json();
            return data.secure_url;
        }

        // Form Submission (Add/Edit)
        document.getElementById('newsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const formData = new FormData(form);
            const id = formData.get('id');
            const file = document.getElementById('newsCoverFile').files[0];

            // Auto generate slug if empty or just based on title
            const title = formData.get('title');
            const slug = title.toLowerCase().replace(/ /g, '-').replace(/[^\w\u0E00-\u0E7F-]+/g, '');

            try {
                let coverUrl = formData.get('existingCover');

                if (file) {
                    try {
                        coverUrl = await uploadImage(file);
                    } catch (uploadError) {
                        alert('Image upload failed: ' + uploadError.message + '\nProceeding without new image.');
                    }
                }

                const newsData = {
                    title: title,
                    event_date: formData.get('date'),
                    tag: formData.get('tag'),
                    description: formData.get('desc'),
                    content: formData.get('content'),
                    cover_image: coverUrl,
                    cover_position: formData.get('cover_position') || 'center',
                    facebook_url: formData.get('facebook_url') || null,
                    slug: slug
                };

                let error;
                if (id) {
                    const res = await supabase.from('news').update(newsData).eq('id', id);
                    error = res.error;
                } else {
                    const res = await supabase.from('news').insert([newsData]);
                    error = res.error;
                }

                if (error) throw error;

                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ');
                closeModal();
                loadNews();

            } catch (error) {
                console.error(error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            }
        });

        // Image Preview Logic
        const fileInput = document.getElementById('newsCoverFile');
        const previewContainer = document.getElementById('coverPreviewContainer');
        const previewImage = document.getElementById('coverPreview');
        const coverUrlInput = document.getElementById('newsCoverUrl');

        fileInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => showPreview(e.target.result);
                reader.readAsDataURL(file);
            }
        });

        function showPreview(src, position = 'center') {
            previewImage.src = src;
            previewImage.style.objectPosition = position;
            previewContainer.classList.remove('hidden');
        }

        window.removeCover = () => {
            fileInput.value = '';
            coverUrlInput.value = '';
            previewContainer.classList.add('hidden');
            previewImage.src = '';
            previewImage.style.objectPosition = 'center';
            document.getElementById('newsCoverPosition').value = 'center';
        };

        // Cover Position Control
        window.setCoverPosition = (position) => {
            document.getElementById('newsCoverPosition').value = position;
            previewImage.style.objectPosition = position;
        };

        // Update position preview when dropdown changes
        document.getElementById('newsCoverPosition').addEventListener('change', function () {
            previewImage.style.objectPosition = this.value;
        });

        // Modal Logic
        window.openModal = () => document.getElementById('newsModal').classList.remove('hidden');

        window.closeModal = () => {
            document.getElementById('newsModal').classList.add('hidden');
            document.getElementById('newsForm').reset();
            document.getElementById('editId').value = '';
            document.getElementById('modalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà';
            window.removeCover();
        };

        window.editNews = (id) => {
            const data = allNewsMap.get(String(id));
            if (!data) return;

            document.getElementById('editId').value = id;
            document.getElementById('newsDate').value = data.event_date || '';
            document.getElementById('newsTag').value = data.tag || '‡∏Ç‡πà‡∏≤‡∏ß';
            document.getElementById('newsTitle').value = data.title || '';
            document.getElementById('newsDesc').value = data.description || '';
            document.getElementById('newsContent').value = data.content || '';
            document.getElementById('newsFacebookUrl').value = data.facebook_url || '';

            // Cover position
            const coverPosition = data.cover_position || 'center';
            document.getElementById('newsCoverPosition').value = coverPosition;

            // For cover, we store the existing path
            document.getElementById('newsCoverUrl').value = data.cover_image || '';
            if (data.cover_image) showPreview(data.cover_image, coverPosition);
            else window.removeCover();

            document.getElementById('modalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß';
            openModal();
        };

        window.deleteNews = async (id) => {
            if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?")) return;
            try {
                const { error } = await supabase.from('news').delete().eq('id', id);
                if (error) throw error;
                loadNews();
            } catch (e) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
            }
        };

        // ========== Gallery Upload Logic ==========
        const galleryFilesInput = document.getElementById('galleryFiles');
        const galleryPreviewGrid = document.getElementById('galleryPreviewGrid');
        const insertGalleryBtn = document.getElementById('insertGalleryBtn');
        const gallerySettingsPanel = document.getElementById('gallerySettings');
        let pendingGalleryFiles = [];
        let uploadedGalleryUrls = [];
        let selectedGallerySize = 'medium';
        let selectedGalleryAlign = 'center';
        let selectedGalleryColumns = 1;

        const sizeMap = { small: '25%', medium: '50%', large: '75%', full: '100%' };

        window.setGallerySize = (size) => {
            selectedGallerySize = size;
            document.querySelectorAll('.gallery-size-btn').forEach(btn => {
                btn.classList.remove('bg-blue-100', 'border-blue-400', 'text-blue-700');
                btn.classList.add('hover:bg-blue-50');
            });
            const active = document.querySelector(`.gallery-size-btn[data-size="${size}"]`);
            if (active) {
                active.classList.add('bg-blue-100', 'border-blue-400', 'text-blue-700');
                active.classList.remove('hover:bg-blue-50');
            }
        };

        window.setGalleryColumns = (cols) => {
            selectedGalleryColumns = cols;
            document.querySelectorAll('.gallery-cols-btn').forEach(btn => {
                btn.classList.remove('bg-blue-100', 'border-blue-400', 'text-blue-700');
                btn.classList.add('hover:bg-blue-50');
            });
            const active = document.querySelector(`.gallery-cols-btn[data-cols="${cols}"]`);
            if (active) {
                active.classList.add('bg-blue-100', 'border-blue-400', 'text-blue-700');
                active.classList.remove('hover:bg-blue-50');
            }
        };

        window.setGalleryAlign = (align) => {
            selectedGalleryAlign = align;
            document.querySelectorAll('.gallery-align-btn').forEach(btn => {
                btn.classList.remove('bg-blue-100', 'border-blue-400', 'text-blue-700');
                btn.classList.add('hover:bg-blue-50');
            });
            const active = document.querySelector(`.gallery-align-btn[data-align="${align}"]`);
            if (active) {
                active.classList.add('bg-blue-100', 'border-blue-400', 'text-blue-700');
                active.classList.remove('hover:bg-blue-50');
            }
        };

        // Preview selected gallery images
        galleryFilesInput.addEventListener('change', function (e) {
            const files = Array.from(e.target.files).slice(0, 10); // Max 10 files
            pendingGalleryFiles = files;
            galleryPreviewGrid.innerHTML = '';
            uploadedGalleryUrls = [];

            if (files.length === 0) {
                insertGalleryBtn.disabled = true;
                gallerySettingsPanel.classList.add('hidden');
                return;
            }

            gallerySettingsPanel.classList.remove('hidden');

            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const div = document.createElement('div');
                    div.className = 'relative aspect-square bg-gray-100 rounded overflow-hidden border';
                    div.innerHTML = `
                        <img src="${event.target.result}" class="w-full h-full object-cover" alt="Preview ${index + 1}">
                        <span class="absolute bottom-1 right-1 bg-black/50 text-white text-xs px-1 rounded">${index + 1}</span>
                    `;
                    galleryPreviewGrid.appendChild(div);
                };
                reader.readAsDataURL(file);
            });

            insertGalleryBtn.disabled = false;
            insertGalleryBtn.textContent = `‡πÅ‡∏ó‡∏£‡∏Å ${files.length} ‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤`;
        });

        // Upload and insert gallery images
        insertGalleryBtn.addEventListener('click', async function () {
            if (pendingGalleryFiles.length === 0) return;

            const originalText = this.textContent;
            this.disabled = true;
            this.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î...';

            try {
                const uploadPromises = pendingGalleryFiles.map(async (file, index) => {
                    this.textContent = `‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î ${index + 1}/${pendingGalleryFiles.length}...`;
                    const url = await uploadImage(file);
                    return url;
                });

                uploadedGalleryUrls = await Promise.all(uploadPromises);

                // Generate HTML for images with size, alignment and grid layout
                const cols = selectedGalleryColumns;
                let imagesHtml = '';

                if (cols > 1) {
                    // Multi-column grid layout
                    const justifyMap = { left: 'flex-start', center: 'center', right: 'flex-end' };
                    const justify = justifyMap[selectedGalleryAlign] || 'center';
                    const gap = '8px';
                    const imgPercent = `calc(${(100 / cols).toFixed(2)}% - ${gap})`;

                    // Split images into rows of N columns
                    const rows = [];
                    for (let i = 0; i < uploadedGalleryUrls.length; i += cols) {
                        rows.push(uploadedGalleryUrls.slice(i, i + cols));
                    }

                    imagesHtml = rows.map(row => {
                        const imgs = row.map((url, i) =>
                            `<img src="${url}" alt="" style="width:${imgPercent}; border-radius:8px; object-fit:cover;">`
                        ).join('\n');
                        return `<div style="display:flex; gap:${gap}; justify-content:${justify}; margin:10px 0;">\n${imgs}\n</div>`;
                    }).join('\n');
                } else {
                    // Single column (original behavior)
                    const imgWidth = sizeMap[selectedGallerySize] || '50%';
                    const alignStyle = selectedGalleryAlign === 'center'
                        ? 'display:block; margin-left:auto; margin-right:auto;'
                        : selectedGalleryAlign === 'right'
                            ? 'display:block; margin-left:auto; margin-right:0;'
                            : 'display:block; margin-left:0; margin-right:auto;';

                    imagesHtml = uploadedGalleryUrls.map((url, i) =>
                        `<img src="${url}" alt="‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà ${i + 1}" style="width:${imgWidth}; max-width:100%; margin-top:10px; margin-bottom:10px; border-radius:8px; ${alignStyle}">`
                    ).join('\n');
                }

                // Insert at cursor position or at end
                const contentArea = document.getElementById('newsContent');
                const cursorPos = contentArea.selectionStart;
                const currentContent = contentArea.value;

                if (cursorPos !== undefined && cursorPos > 0) {
                    // Insert at cursor
                    contentArea.value = currentContent.slice(0, cursorPos) + '\n' + imagesHtml + '\n' + currentContent.slice(cursorPos);
                } else {
                    // Append at end
                    contentArea.value = currentContent + '\n' + imagesHtml;
                }

                // Clear gallery selection
                galleryFilesInput.value = '';
                galleryPreviewGrid.innerHTML = '';
                pendingGalleryFiles = [];
                uploadedGalleryUrls = [];

                gallerySettingsPanel.classList.add('hidden');
                alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ${uploadPromises.length} ‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`);
                this.textContent = '‡πÅ‡∏ó‡∏£‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤';
                this.disabled = true;

            } catch (error) {
                console.error('Gallery upload error:', error);
                alert('‚ùå ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message);
                this.textContent = originalText;
                this.disabled = false;
            }
        });

        // Clear gallery when modal closes
        const originalCloseModal = window.closeModal;
        window.closeModal = () => {
            originalCloseModal();
            galleryFilesInput.value = '';
            galleryPreviewGrid.innerHTML = '';
            pendingGalleryFiles = [];
            uploadedGalleryUrls = [];
            insertGalleryBtn.disabled = true;
            insertGalleryBtn.textContent = '‡πÅ‡∏ó‡∏£‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤';
            gallerySettingsPanel.classList.add('hidden');
            selectedGallerySize = 'medium';
            selectedGalleryAlign = 'center';
            selectedGalleryColumns = 1;
            setGallerySize('medium');
            setGalleryAlign('center');
            setGalleryColumns(1);
        };

        // ========== Tab Switching ==========
        window.switchTab = (tab) => {
            const newsSection = document.getElementById('newsSection');
            const bannersSection = document.getElementById('bannersSection');
            const eventsSection = document.getElementById('eventsSection');
            const donationSection = document.getElementById('donationSection');
            const staffSection = document.getElementById('staffSection');
            const documentsSection = document.getElementById('documentsSection');
            const tabNews = document.getElementById('tabNews');
            const tabBanners = document.getElementById('tabBanners');
            const tabEvents = document.getElementById('tabEvents');
            const tabDonation = document.getElementById('tabDonation');
            const tabStaff = document.getElementById('tabStaff');
            const tabDocuments = document.getElementById('tabDocuments');

            // Hide all sections
            newsSection.classList.add('hidden');
            bannersSection.classList.add('hidden');
            eventsSection.classList.add('hidden');
            donationSection.classList.add('hidden');
            staffSection.classList.add('hidden');
            documentsSection.classList.add('hidden');

            // Reset all tabs
            [tabNews, tabBanners, tabEvents, tabDonation, tabStaff, tabDocuments].forEach(t => {
                t.classList.remove('border-b-2', 'border-blue-600', 'text-blue-600');
                t.classList.add('text-gray-500');
            });

            // Show selected
            if (tab === 'news') {
                newsSection.classList.remove('hidden');
                tabNews.classList.add('border-b-2', 'border-blue-600', 'text-blue-600');
                tabNews.classList.remove('text-gray-500');
            } else if (tab === 'banners') {
                bannersSection.classList.remove('hidden');
                tabBanners.classList.add('border-b-2', 'border-blue-600', 'text-blue-600');
                tabBanners.classList.remove('text-gray-500');
                loadBanners();
            } else if (tab === 'events') {
                eventsSection.classList.remove('hidden');
                tabEvents.classList.add('border-b-2', 'border-blue-600', 'text-blue-600');
                tabEvents.classList.remove('text-gray-500');
                loadEvents();
            } else if (tab === 'donation') {
                donationSection.classList.remove('hidden');
                tabDonation.classList.add('border-b-2', 'border-blue-600', 'text-blue-600');
                tabDonation.classList.remove('text-gray-500');
                loadDonationSettings();
                loadDonors();
            } else if (tab === 'staff') {
                staffSection.classList.remove('hidden');
                tabStaff.classList.add('border-b-2', 'border-blue-600', 'text-blue-600');
                tabStaff.classList.remove('text-gray-500');
                loadStaff();
            } else if (tab === 'documents') {
                documentsSection.classList.remove('hidden');
                tabDocuments.classList.add('border-b-2', 'border-blue-600', 'text-blue-600');
                tabDocuments.classList.remove('text-gray-500');
                loadDocuments();
            }
        };

        // ========== Banner Management ==========
        let allBannersMap = new Map();

        async function loadBanners() {
            const tableBody = document.getElementById('bannersTableBody');
            tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';

            try {
                const { data, error } = await supabase
                    .from('banners')
                    .select('*')
                    .order('sort_order', { ascending: true });

                if (error) throw error;

                tableBody.innerHTML = '';
                allBannersMap.clear();

                if (!data || data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</td></tr>';
                    return;
                }

                data.forEach(item => {
                    allBannersMap.set(String(item.id), item);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-3">
                            <img src="${item.image_url || 'https://via.placeholder.com/120x40'}" 
                                 class="h-12 w-32 object-cover rounded bg-gray-200">
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900">${item.title || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-500 max-w-xs truncate">${item.link_url || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-500">${item.sort_order || 0}</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs rounded-full ${item.is_active ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                ${item.is_active ? 'üü¢ ‡πÄ‡∏õ‡∏¥‡∏î' : 'üî¥ ‡∏õ‡∏¥‡∏î'}
                            </span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <button onclick="window.editBanner('${item.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="window.deleteBanner('${item.id}')" class="text-red-600 hover:text-red-900">‡∏•‡∏ö</button>
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });
            } catch (e) {
                console.error(e);
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</td></tr>`;
            }
        }

        function openBannerModal(editId = null) {
            document.getElementById('bannerModal').classList.remove('hidden');
            document.getElementById('bannerForm').reset();
            document.getElementById('editBannerId').value = editId || '';
            document.getElementById('bannerModalTitle').textContent = editId ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå';
            document.getElementById('bannerImagePreview').src = 'https://via.placeholder.com/400x150?text=Preview';
            document.getElementById('bannerImageUrl').value = '';
            document.getElementById('bannerSortOrder').value = '1';
            document.getElementById('bannerIsActive').value = 'true';
        }

        window.closeBannerModal = () => {
            document.getElementById('bannerModal').classList.add('hidden');
        };

        window.editBanner = (id) => {
            const item = allBannersMap.get(String(id));
            if (!item) return;

            openBannerModal(id);
            document.getElementById('bannerTitle').value = item.title || '';
            document.getElementById('bannerImageUrl').value = item.image_url || '';
            document.getElementById('bannerImagePreview').src = item.image_url || 'https://via.placeholder.com/400x150?text=Preview';
            document.getElementById('bannerLinkUrl').value = item.link_url || '';
            document.getElementById('bannerSortOrder').value = item.sort_order || 1;
            document.getElementById('bannerIsActive').value = item.is_active ? 'true' : 'false';
            document.getElementById('bannerImagePosition').value = item.image_position || 'center';
            document.getElementById('bannerImagePreview').style.objectPosition = item.image_position || 'center';
        };

        window.deleteBanner = async (id) => {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ?')) return;

            try {
                const { error } = await supabase.from('banners').delete().eq('id', id);
                if (error) throw error;
                alert('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                loadBanners();
            } catch (e) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
            }
        };

        // Banner image preview
        document.getElementById('bannerImageFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    document.getElementById('bannerImagePreview').src = ev.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Banner form submission
        document.getElementById('bannerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const id = document.getElementById('editBannerId').value;
            const file = document.getElementById('bannerImageFile').files[0];

            try {
                let imageUrl = document.getElementById('bannerImageUrl').value;

                // Upload image if new file selected
                if (file) {
                    const compressedFile = await compressImage(file, 1600, 0.85);
                    const uniqueId = `banner_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
                    const formData = new FormData();
                    formData.append('file', compressedFile);
                    formData.append('upload_preset', 'school_uploads');
                    formData.append('folder', 'banners');
                    formData.append('public_id', uniqueId);

                    const response = await fetch(
                        'https://api.cloudinary.com/v1_1/dlisgusfp/image/upload',
                        { method: 'POST', body: formData }
                    );

                    if (!response.ok) throw new Error('Upload failed');
                    const data = await response.json();
                    imageUrl = data.secure_url;
                }

                const bannerData = {
                    title: document.getElementById('bannerTitle').value || '',
                    image_url: imageUrl,
                    link_url: document.getElementById('bannerLinkUrl').value || '',
                    sort_order: parseInt(document.getElementById('bannerSortOrder').value) || 1,
                    is_active: document.getElementById('bannerIsActive').value === 'true',
                    image_position: document.getElementById('bannerImagePosition').value || 'center'
                };

                let error;
                if (id) {
                    const res = await supabase.from('banners').update(bannerData).eq('id', id);
                    error = res.error;
                } else {
                    const res = await supabase.from('banners').insert([bannerData]);
                    error = res.error;
                }

                if (error) throw error;

                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                closeBannerModal();
                loadBanners();
            } catch (e) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            }
        });

        // ========== Staff Management ==========
        let allStaffMap = new Map();

        async function loadStaff() {
            const tableBody = document.getElementById('staffTableBody');
            tableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';

            try {
                const { data, error } = await supabase
                    .from('staff')
                    .select('*')
                    .order('sort_order', { ascending: true });

                if (error) throw error;

                tableBody.innerHTML = '';
                allStaffMap.clear();

                if (!data || data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</td></tr>';
                    return;
                }

                data.forEach(item => {
                    allStaffMap.set(String(item.id), item);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-3">
                            <img src="${item.photo_url || 'https://via.placeholder.com/60?text=No'}" 
                                 class="w-12 h-12 rounded-full object-cover bg-gray-200"
                                 onerror="this.src='https://via.placeholder.com/60?text=No'">
                        </td>
                        <td class="px-4 py-3 text-sm font-medium">${item.name}</td>
                        <td class="px-4 py-3 text-sm text-gray-500">${item.position || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-400">${item.sort_order || '-'}</td>
                        <td class="px-4 py-3 text-sm">
                            <button onclick="editStaff('${item.id}')" class="text-indigo-600 hover:text-indigo-900 mr-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="deleteStaff('${item.id}')" class="text-red-600 hover:text-red-900">‡∏•‡∏ö</button>
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });
            } catch (e) {
                console.error('Error loading staff:', e);
                tableBody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-red-500">Error: ${e.message}</td></tr>`;
            }
        }

        window.openStaffModal = () => document.getElementById('staffModal').classList.remove('hidden');

        window.closeStaffModal = () => {
            document.getElementById('staffModal').classList.add('hidden');
            document.getElementById('staffForm').reset();
            document.getElementById('editStaffId').value = '';
            document.getElementById('staffPhotoUrl').value = '';
            document.getElementById('staffModalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£';
            document.getElementById('staffSortOrder').value = '10';
            document.getElementById('staffPhotoPreview').src = 'https://via.placeholder.com/80?text=No+Photo';
            document.getElementById('staffPhotoFile').value = '';
            document.getElementById('staffPhotoUrlInput').value = '';
        };

        // Staff photo preview
        document.getElementById('staffPhotoFile').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('staffPhotoPreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Upload photo to Cloudinary
        const CLOUDINARY_CLOUD_NAME = 'dlisgusfp';
        const CLOUDINARY_UPLOAD_PRESET = 'school_uploads'; // ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô Cloudinary Settings
        const CLOUDINARY_API_KEY = '792616562269569'; // ‡πÉ‡∏™‡πà API Key ‡∏à‡∏≤‡∏Å Cloudinary Dashboard

        // Cloudinary Media Library Browser
        let currentBrowserTarget = null;

        window.openCloudinaryBrowser = function (target) {
            currentBrowserTarget = target;

            // Check if API Key is set
            if (!CLOUDINARY_API_KEY) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key ‡πÉ‡∏ô admin.html\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥:\n1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Cloudinary Dashboard ‚Üí Settings ‚Üí Access Keys\n2. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å API Key\n3. ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô CLOUDINARY_API_KEY ‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1028');
                return;
            }

            if (typeof cloudinary === 'undefined' || !cloudinary.createMediaLibrary) {
                alert('Cloudinary Media Library Widget ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤');
                return;
            }

            const mediaLibrary = cloudinary.createMediaLibrary({
                cloud_name: CLOUDINARY_CLOUD_NAME,
                api_key: CLOUDINARY_API_KEY,
                multiple: false,
                max_files: 1
            }, {
                insertHandler: function (data) {
                    if (data && data.assets && data.assets.length > 0) {
                        const asset = data.assets[0];
                        const url = asset.secure_url;

                        if (currentBrowserTarget === 'staff') {
                            document.getElementById('staffPhotoUrlInput').value = url;
                            document.getElementById('staffPhotoPreview').src = url;
                        } else if (currentBrowserTarget === 'news') {
                            document.getElementById('newsCoverUrlInput').value = url;
                            document.getElementById('coverPreview').src = url;
                            document.getElementById('coverPreview').classList.remove('hidden');
                        }
                    }
                }
            });

            mediaLibrary.show();
        };

        async function uploadStaffPhoto(file) {
            // Compress image before upload (400px for staff photos, 80% quality)
            const compressedFile = await compressImage(file, 400, 0.80);

            // Generate unique public_id to prevent caching issues
            const uniqueId = `staff_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;

            const formData = new FormData();
            formData.append('file', compressedFile);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
            formData.append('folder', 'staff');
            formData.append('public_id', uniqueId); // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

            const response = await fetch(
                `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,
                { method: 'POST', body: formData }
            );

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || 'Upload failed');
            }

            const data = await response.json();
            return data.secure_url; // Return the HTTPS URL
        }

        window.editStaff = (id) => {
            const data = allStaffMap.get(String(id));
            if (!data) return;

            document.getElementById('editStaffId').value = id;
            document.getElementById('staffName').value = data.name || '';
            document.getElementById('staffPosition').value = data.position || '';
            document.getElementById('staffCategory').value = data.category || 'executive';
            document.getElementById('staffPhotoUrl').value = data.photo_url || '';
            document.getElementById('staffSortOrder').value = data.sort_order || 10;

            // Show existing photo
            document.getElementById('staffPhotoPreview').src = data.photo_url || 'https://via.placeholder.com/80?text=No+Photo';

            document.getElementById('staffModalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£';
            openStaffModal();
        };

        window.deleteStaff = async (id) => {
            if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ô‡∏µ‡πâ?")) return;
            try {
                const { error } = await supabase.from('staff').delete().eq('id', id);
                if (error) throw error;
                loadStaff();
            } catch (e) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
            }
        };

        // Staff Form Submission
        document.getElementById('staffForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const formData = new FormData(form);
            const id = formData.get('id');
            const photoFile = document.getElementById('staffPhotoFile').files[0];
            const urlInput = document.getElementById('staffPhotoUrlInput').value.trim();

            try {
                let photoUrl = formData.get('photo_url'); // Keep existing URL

                // Priority: 1. New URL input, 2. New file upload, 3. Keep existing
                if (urlInput) {
                    photoUrl = urlInput;
                } else if (photoFile) {
                    submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ...';
                    photoUrl = await uploadStaffPhoto(photoFile);
                }

                const staffData = {
                    name: formData.get('name'),
                    position: formData.get('position'),
                    category: formData.get('category'),
                    photo_url: photoUrl,
                    sort_order: parseInt(formData.get('sort_order')) || 10
                };

                let error;
                if (id) {
                    const res = await supabase.from('staff').update(staffData).eq('id', id);
                    error = res.error;
                } else {
                    const res = await supabase.from('staff').insert([staffData]);
                    error = res.error;
                }

                if (error) throw error;

                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ');
                closeStaffModal();
                loadStaff();

            } catch (error) {
                console.error(error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            }
        });

        // ========== Donation Management ==========
        async function loadDonationSettings() {
            try {
                const { data, error } = await supabase
                    .from('donation_settings')
                    .select('*')
                    .single();

                if (error && error.code !== 'PGRST116') throw error; // PGRST116 = no rows

                if (data) {
                    document.getElementById('qrCodeUrl').value = data.qr_code_url || '';
                    document.getElementById('accountName').value = data.account_name || '';
                    document.getElementById('bankName').value = data.bank_name || '';
                    document.getElementById('accountNumber').value = data.account_number || '';
                    document.getElementById('projectName').value = data.project_name || '';
                    document.getElementById('totalAmount').value = data.total_amount || 0;
                    document.getElementById('goalAmount').value = data.goal_amount || 500000;
                    document.getElementById('donorCount').value = data.donor_count || 0;
                }
            } catch (e) {
                console.error('Error loading donation settings:', e);
            }
        }

        async function loadDonors() {
            const tableBody = document.getElementById('donorsTableBody');
            tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';

            try {
                const { data, error } = await supabase
                    .from('donors')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                tableBody.innerHTML = '';

                if (!data || data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr>';
                    return;
                }

                data.forEach(d => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-2 text-sm">${d.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</td>
                        <td class="px-4 py-2 text-sm font-medium text-green-600">‡∏ø${Number(d.amount).toLocaleString()}</td>
                        <td class="px-4 py-2 text-xs text-gray-500">${new Date(d.created_at).toLocaleDateString('th-TH')}</td>
                        <td class="px-4 py-2 text-center">
                            <button onclick="deleteDonor('${d.id}')" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });
            } catch (e) {
                console.error('Error loading donors:', e);
                tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-red-500">Error: ${e.message}</td></tr>`;
            }
        }

        // Donation Settings Form
        document.getElementById('donationSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            try {
                const settingsData = {
                    qr_code_url: document.getElementById('qrCodeUrl').value,
                    account_name: document.getElementById('accountName').value,
                    bank_name: document.getElementById('bankName').value,
                    account_number: document.getElementById('accountNumber').value,
                    project_name: document.getElementById('projectName').value,
                    total_amount: parseInt(document.getElementById('totalAmount').value) || 0,
                    goal_amount: parseInt(document.getElementById('goalAmount').value) || 500000,
                    donor_count: parseInt(document.getElementById('donorCount').value) || 0
                };

                // Upsert (insert or update)
                const { error } = await supabase
                    .from('donation_settings')
                    .upsert(settingsData, { onConflict: 'id' });

                if (error) throw error;

                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ');
            } catch (error) {
                console.error(error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤';
            }
        });

        // Donor Modal
        window.openDonorModal = () => document.getElementById('donorModal').classList.remove('hidden');
        window.closeDonorModal = () => {
            document.getElementById('donorModal').classList.add('hidden');
            document.getElementById('donorForm').reset();
        };

        window.deleteDonor = async (id) => {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) return;
            try {
                const { error } = await supabase.from('donors').delete().eq('id', id);
                if (error) throw error;
                loadDonors();
            } catch (e) {
                alert('Error: ' + e.message);
            }
        };

        // Donor Form
        document.getElementById('donorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            try {
                const donorData = {
                    name: document.getElementById('donorName').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠',
                    amount: parseInt(document.getElementById('donorAmount').value) || 0,
                    message: document.getElementById('donorMessage').value || ''
                };

                const { error } = await supabase.from('donors').insert([donorData]);
                if (error) throw error;

                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ');
                closeDonorModal();
                loadDonors();

                // Update donor count
                const countInput = document.getElementById('donorCount');
                countInput.value = parseInt(countInput.value) + 1;

            } catch (error) {
                console.error(error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            }
        });

        // ========== Events Management ==========
        let allEventsMap = new Map();

        async function loadEvents() {
            const tableBody = document.getElementById('eventsTableBody');
            tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';

            try {
                const { data, error } = await supabase
                    .from('events')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                tableBody.innerHTML = '';
                allEventsMap.clear();

                if (!data || data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</td></tr>';
                    return;
                }

                data.forEach(item => {
                    allEventsMap.set(String(item.id), item);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="text-lg font-bold text-blue-600">${item.day || '-'}</span>
                            <span class="text-sm text-gray-500 ml-1">${item.month || ''}</span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">${item.title}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${item.place || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="window.editEvent('${item.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="window.deleteEvent('${item.id}')" class="text-red-600 hover:text-red-900">‡∏•‡∏ö</button>
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });
            } catch (e) {
                console.error(e);
                tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</td></tr>`;
            }
        }

        // Event Modal Functions
        window.openEventModal = () => document.getElementById('eventModal').classList.remove('hidden');

        window.closeEventModal = () => {
            document.getElementById('eventModal').classList.add('hidden');
            document.getElementById('eventForm').reset();
            document.getElementById('editEventId').value = '';
            document.getElementById('eventModalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà';
        };

        window.editEvent = (id) => {
            const data = allEventsMap.get(String(id));
            if (!data) return;

            document.getElementById('editEventId').value = id;
            document.getElementById('eventDay').value = data.day || '';
            document.getElementById('eventMonth').value = data.month || '';
            document.getElementById('eventTitle').value = data.title || '';
            document.getElementById('eventPlace').value = data.place || '';

            document.getElementById('eventModalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°';
            openEventModal();
        };

        window.deleteEvent = async (id) => {
            if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ?")) return;
            try {
                const { error } = await supabase.from('events').delete().eq('id', id);
                if (error) throw error;
                loadEvents();
            } catch (e) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
            }
        };

        // Event Form Submission
        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const formData = new FormData(form);
            const id = formData.get('id');

            try {
                const eventData = {
                    day: formData.get('day'),
                    month: formData.get('month'),
                    title: formData.get('title'),
                    place: formData.get('place')
                };

                let error;
                if (id) {
                    const res = await supabase.from('events').update(eventData).eq('id', id);
                    error = res.error;
                } else {
                    const res = await supabase.from('events').insert([eventData]);
                    error = res.error;
                }

                if (error) throw error;

                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ');
                closeEventModal();
                loadEvents();

            } catch (error) {
                console.error(error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            }
        });

        // ========== Documents Management ==========
        let allDocumentsMap = new Map();

        async function loadDocuments() {
            const tableBody = document.getElementById('documentsTableBody');
            tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';

            try {
                const { data, error } = await supabase
                    .from('documents')
                    .select('*')
                    .order('sort_order', { ascending: true });

                if (error) throw error;

                tableBody.innerHTML = '';
                allDocumentsMap.clear();

                if (!data || data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</td></tr>';
                    return;
                }

                data.forEach(item => {
                    allDocumentsMap.set(String(item.id), item);
                    const shortUrl = (item.file_url || '').length > 40 ? item.file_url.substring(0, 40) + '...' : (item.file_url || '-');
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-3 text-sm text-gray-900 font-medium">${item.title}</td>
                        <td class="px-4 py-3 text-sm text-gray-500 max-w-xs truncate">
                            <a href="${item.file_url || '#'}" target="_blank" class="text-blue-600 hover:underline" title="${item.file_url || ''}">${shortUrl}</a>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-500">${item.sort_order || 0}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <button onclick="window.editDocument('${item.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="window.deleteDocument('${item.id}')" class="text-red-600 hover:text-red-900">‡∏•‡∏ö</button>
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });
            } catch (e) {
                console.error(e);
                tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</td></tr>`;
            }
        }

        // Toggle link/file fields
        window.toggleDocType = () => {
            const type = document.querySelector('input[name="doc_type"]:checked').value;
            document.getElementById('docLinkField').classList.toggle('hidden', type !== 'link');
            document.getElementById('docFileField').classList.toggle('hidden', type !== 'file');
        };

        // Document Modal Functions
        window.openDocumentModal = () => document.getElementById('documentModal').classList.remove('hidden');

        window.closeDocumentModal = () => {
            document.getElementById('documentModal').classList.add('hidden');
            document.getElementById('documentForm').reset();
            document.getElementById('editDocumentId').value = '';
            document.getElementById('documentModalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£';
            // Reset to link mode
            document.querySelector('input[name="doc_type"][value="link"]').checked = true;
            toggleDocType();
        };

        window.editDocument = (id) => {
            const data = allDocumentsMap.get(String(id));
            if (!data) return;

            document.getElementById('editDocumentId').value = id;
            document.getElementById('documentTitle').value = data.title || '';
            document.getElementById('documentUrl').value = data.file_url || '';
            document.getElementById('documentSortOrder').value = data.sort_order || 1;

            // Set to link mode for editing
            document.querySelector('input[name="doc_type"][value="link"]').checked = true;
            toggleDocType();

            document.getElementById('documentModalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£';
            openDocumentModal();
        };

        window.deleteDocument = async (id) => {
            if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) return;
            try {
                const { error } = await supabase.from('documents').delete().eq('id', id);
                if (error) throw error;
                loadDocuments();
            } catch (e) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
            }
        };

        // Upload document file to Supabase Storage
        async function uploadDocumentFile(file) {
            const fileExt = file.name.split('.').pop();
            const fileName = `doc_${Date.now()}_${Math.random().toString(36).substring(2, 8)}.${fileExt}`;
            const filePath = `documents/${fileName}`;

            const { data, error } = await supabase.storage
                .from('uploads')
                .upload(filePath, file);

            if (error) throw error;

            const { data: urlData } = supabase.storage
                .from('uploads')
                .getPublicUrl(filePath);

            return urlData.publicUrl;
        }

        // Document Form Submission
        document.getElementById('documentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const formData = new FormData(form);
            const id = formData.get('id');
            const docType = document.querySelector('input[name="doc_type"]:checked').value;

            try {
                let fileUrl = formData.get('file_url') || '';

                // If file upload mode, upload the file first
                if (docType === 'file') {
                    const fileInput = document.getElementById('documentFile');
                    if (fileInput.files.length > 0) {
                        fileUrl = await uploadDocumentFile(fileInput.files[0]);
                    } else if (!id) {
                        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå');
                        return;
                    }
                }

                const docData = {
                    title: formData.get('title'),
                    file_url: fileUrl,
                    sort_order: parseInt(formData.get('sort_order')) || 1
                };

                let error;
                if (id) {
                    const res = await supabase.from('documents').update(docData).eq('id', id);
                    error = res.error;
                } else {
                    const res = await supabase.from('documents').insert([docData]);
                    error = res.error;
                }

                if (error) throw error;

                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ');
                closeDocumentModal();
                loadDocuments();

            } catch (error) {
                console.error(error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            }
        });

    </script>
</body>

</html>